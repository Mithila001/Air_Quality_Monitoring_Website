@model IEnumerable<SDTP_Project1.Models.Location>

@{
    ViewData["Title"] = "Air Quality Dashboard";
}

<h2>Air Quality Dashboard - Colombo</h2>
<div id="map" style="height: 500px;"></div>

@section Scripts {
    <!-- Load Leaflet from CDN -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

    <script>
        // Initialize the map centered on Colombo (approximate coordinates)
        var map = L.map('map').setView([6.9271, 79.8612], 12);

        // Add OpenStreetMap tile layer.
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 18,
            attribution: '© OpenStreetMap contributors'
        }).addTo(map);

        // Get the locations passed from the controller
        var locations = @Html.Raw(Json.Serialize(Model));

        // Add markers for each location
        locations.forEach(function(loc) {
            L.marker([loc.latitude, loc.longitude]).addTo(map)
                .bindPopup("<b>" + loc.name + "</b><br>Air Quality Index: " + loc.airQualityIndex);
        });
    </script>
}
